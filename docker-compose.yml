version: '3.8'

services:
  tts-service:
    build: ./tts-service
    container_name: voicewrite-tts
    ports:
      - "8000:8000"
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1
      # PulseAudio for audio output
      - PULSE_SERVER=unix:${XDG_RUNTIME_DIR}/pulse/native
      - PULSE_COOKIE=/tmp/pulse-cookie
    volumes:
      - ./tts-service:/app
      - voicewrite-tts-models:/root/.cache/huggingface  # Cache KittenTTS models
      - ${XDG_RUNTIME_DIR}/pulse/native:${XDG_RUNTIME_DIR}/pulse/native  # Audio socket
      - /tmp:/tmp  # Temp audio files
    devices:
      - /dev/snd:/dev/snd  # Audio device access
    group_add:
      - audio  # Audio group

volumes:
  voicewrite-tts-models:  # Persist downloaded models
