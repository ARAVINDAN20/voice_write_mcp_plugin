version: '3.8'

services:
  tts-service:
    build: ./tts-service
    container_name: voicewrite-tts
    ports:
      - "8000:8000"
    restart: unless-stopped
    env_file: .env
    environment:
      - PYTHONUNBUFFERED=1
      # PulseAudio environment variables for audio support
      - PULSE_SERVER=unix:${XDG_RUNTIME_DIR}/pulse/native
      - PULSE_COOKIE=/tmp/pulse-cookie
    volumes:
      - ./tts-service:/app
      - voicewrite-tts-data:/root/.cache
      # Mount PulseAudio socket for audio playback
      - ${XDG_RUNTIME_DIR}/pulse/native:${XDG_RUNTIME_DIR}/pulse/native
      - /tmp:/tmp
    devices:
      # Allow access to audio devices
      - /dev/snd:/dev/snd
    group_add:
      # Add audio group if it exists
      - audio

volumes:
  voicewrite-tts-data:
